<html>
<head>
    <title></title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.4.0/build/cssgrids/grids-min.css">
    <script src="http://yui.yahooapis.com/3.4.0/build/yui/yui-min.js"></script>
    <script type="text/javascript" src="../../src/js-dependencies/webgl-debug.js"></script>
    <script type="text/javascript" src="../../src/js/constants.js"></script>
    <script type="text/javascript" src="../../src/js/glslconstants.js"></script>
    <script type="text/javascript" src="../../src/js/core.js"></script>
    <script type="text/javascript" src="../../src/js/resource.js"></script>
    <script type="text/javascript" src="../../src/js/math.js"></script>
    <script type="text/javascript" src="../../src/js/mesh.js"></script>
    <script type="text/javascript" src="../../src/js/scene.js"></script>
    <script type="text/javascript" src="../../src/js/renderer.js"></script>
    <script type="text/javascript" src="../../src/js/material.js"></script>
    <script type="text/javascript" src="../../src/js/meshfactory.js"></script>
    <script type="text/javascript" src="../../src/js/texture.js"></script>
</head>
<body onload="initKick();">
  <canvas id="canvas" style="border: none;" width="300" height="300"></canvas> <br>
  Shows how the Project class can be used

  <div style="display:none;">
  <textarea style="width:500px;height:150px;" id="vertexShaderColor">
attribute vec3 vertex;
attribute vec2 uv1;

uniform mat4 _mvProj;

varying vec3 vColor;

void main(void) {
    gl_Position = _mvProj * vec4(vertex, 1.0);
    vColor = vec3(uv1.x,uv1.y,0.0);
}
  </textarea>
  <textarea style="width:500px;height:150px;" id="fragmentShader">
#ifdef GL_ES
precision highp float;
#endif
varying vec3 vColor;
void main(void)
{
    gl_FragColor = vec4(vColor.x, vColor.y, vColor.z, 1.0);
}
  </textarea>
</div>
  <script type="text/javascript">
        "use strict";
        var engine;
        var meshRenderer;
        var projectData = [
            {
                type:"KICK.texture.Texture",
                config:{
                    name:"Some texture",
                    dataURI:"http://khm0.googleapis.com/kh?v=95&x=0&y=0&z=0"
                }
            },
            {
                type:"KICK.texture.Texture",
                config:{
                    name:"White texture",
                    dataURI:"kickjs://texture/white/",
                    vertexShaderSrc: document.getElementById("vertexShaderColor").value,
                    fragmentShaderSrc: document.getElementById("fragmentShader").value

                }
            },
            {
                type:"KICK.material.Shader",
                config:{
                    name:"UnlitShader",
                    dataURI:"kickjs://shader/unlit/",
                    vertexShaderSrc: document.getElementById("vertexShaderColor").value,
                    fragmentShaderSrc: document.getElementById("fragmentShader").value
                }
            },
            {
                type:"KICK.material.Material",
                config: {
                    name:"BlueMaterial",
                    shader:"UnlitShader",
                    uniforms: {
                        mainTexture:{
                            value:{
                                ref:"White texture",
                                reftype:"project"
                            },
                            type:35678
                        },
                        mainColor:{
                            value:[0,0,1],
                            type:35666
                        }
                    }
                }
            },
            {
                type:"KICK.material.Material",
                config: {
                    name:"SphereMaterial",
                    shader:"UnlitShader",
                    uniforms: {
                        mainColor:{
                            value:[1,0,0],
                            type:35666
                        }
                    }
                }
            },
            {
                type:"KICK.mesh.Mesh",
                config: {
                    name:"CubeMesh",
                    urlResource:"kickjs://meshdata/cube/?length=0.5"
                }
            },
            {
                type:"KICK.mesh.Mesh",
                config: {
                    name:"SphereMesh",
                    urlResource:"kickjs://meshdata/uvsphere/?radius=0.6"
                }
            },
            {
                type:"KICK.scene.Scene",
                config:{
                    name:"SimpleScene",
                    gameObjects:[
                        {
                            name:"MainCamera",
                            uid:5,
                            components:[
                                {
                                    type:"KICK.scene.Transform",
                                    uid:6,
                                    config: {
                                        localPosition: [1,2,3],
                                        localRotationQuat: [4,5,6,1],
                                        localScale:[1,1,1],
                                        parent:null
                                    }
                                },
                                {
                                    type:"KICK.scene.Camera",
                                    uid:7,
                                    config:{
                                        clearColor: [1,0,0,1],
                                        fieldOfView: 60
                                    }
                                },
                                {
                                    type:"Rotator",
                                    uid:8,
                                    config:{}
                                }
                            ]
                        },
                        {
                            name:"Cube",
                            uid:9,
                            components:[
                                {
                                    type:"KICK.scene.MeshRenderer",
                                    uid:10,
                                    config:{
                                        material:{
                                            ref:"BlueMaterial",
                                            reftype:"project"
                                        },
                                        mesh:{
                                            ref:"CubeMesh",
                                            reftype:"project"
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            name:"Cube2",
                            uid:11,
                            components:[
                                {
                                    type:"KICK.scene.Transform",
                                    uid:12,
                                    config: {
                                        localPosition: [0,1,0],
                                        localRotationQuat: [0,0,0,1],
                                        localScale:[1,1,1],
                                        parent:null
                                    }
                                },
                                {
                                    type:"KICK.scene.MeshRenderer",
                                    uid:13,
                                    config:{
                                        material:{
                                            ref:"SphereMaterial",
                                            reftype:"project"
                                        },
                                        mesh:{
                                            ref:"SphereMesh",
                                            reftype:"project"
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                }
            }
        ];

        function Rotator(config){
            var time = engine.time,
                    transform,
                    rotationSpeed = 0.001,
                    translation,
                    rotVec,
                    radius = 5,
                    radianToDegree = KICK.core.Constants._RADIAN_TO_DEGREE,
                    res = document.getElementById("res");
            this.activated = function(){
                var gameObject = this.gameObject;
                transform = gameObject.transform;
                translation = transform.localPosition;
                rotVec = transform.localRotationEuler;
            };

            this.update = function(){
                var timeTotal = time.time,
                        rot = timeTotal*rotationSpeed;
                translation[0] = Math.sin(rot)*radius;
                translation[1] = Math.sin(rot*3);
                translation[2] = Math.cos(rot)*radius;
                rotVec[1] = rot*radianToDegree;
                transform.localPosition = translation;

                //new Date().getMilliseconds();
                transform.localRotationEuler = rotVec;
            }
        }

        function initKick() {
            engine = new KICK.core.Engine('canvas',{
                enableDebugContext: true
            });
            var project = engine.project;
            project.loadProject(projectData);
            console.log(project.load("White texture"));
            console.log(project.load("BlueMaterial"));
            // A simple way to test that the project can be serialized and reloaded (without loosing data)
            project.loadProject(project.toJSON());
            engine.activeScene = project.load("SimpleScene");
            var sceneCopy = engine.activeScene.toJSON();
            sceneCopy.name ="SerializedScene";
            project.addResourceDescriptor(new KICK.core.ResourceDescriptor({
                type: "KICK.scene.Scene",
                config:sceneCopy
            }));
            console.dir(sceneCopy);
            console.dir(project.load("SerializedScene"));
            console.log(project.load("BlueMaterial"));
            engine.activeScene = project.load("SerializedScene");
        }
    </script>
</body>
</html>
